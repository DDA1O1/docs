---
---
<div class="chart-container">
  <canvas id="complexityChart"></canvas>
</div>

<script>
  import Chart from 'chart.js/auto';

  let complexityChart: Chart | null = null; // Variable to hold the chart instance

  function createChart() {
    const ctx = document.getElementById('complexityChart') as HTMLCanvasElement;
    if (!ctx) return;

    // If a chart instance already exists, destroy it before creating a new one
    if (complexityChart) {
      complexityChart.destroy();
    }

    const points = Array.from({length: 20}, (_, i) => i);

    complexityChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: points,
        datasets: [
          {
            label: 'O(1)',
            data: points.map(() => 1),
            borderColor: 'rgba(75, 192, 192, 1)',
          },
          {
            label: 'O(log n)',
            data: points.map(x => Math.log2(x + 1)),
            borderColor: 'rgba(54, 162, 235, 1)',
          },
          {
            label: 'O(n)',
            data: points.map(x => x),
            borderColor: 'rgba(255, 99, 132, 1)',
          },
          {
            label: 'O(nÂ²)',
            data: points.map(x => x * x),
            borderColor: 'rgba(153, 102, 255, 1)',
          },
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false, // Keep this false
        scales: {
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: 'Operations'
            }
          },
          x: {
            title: {
              display: true,
              text: 'Input Size'
            }
          }
        }
      }
    });
  }

  // Use Astro's page-load event for reliable execution on navigation
  document.addEventListener('astro:page-load', createChart);

  // Initial call for the first page load
  createChart();
</script>

<style>
.chart-container {
  position: relative; 
  width: 100%;
  max-width: 800px;
  margin: 2rem auto;
  padding: 1rem;
  height: 400px;
}
</style>